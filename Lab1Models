from pathlib import Path
import csv
from typing import List, Dict

DATA_FILE = Path(__file__).parent.parent / "data" / "lab1_data.csv"

class Lab1Model:

  def __init__(self, data_file: Path = DATA_FILE) -> None:
    self.data_file = data_file
    self.data_file.parent.mkdir(parents=True, exist_ok=True)
    if not self.data_file.exists():
      self._create_header()


  def _create_header(self) -> None:
    with self.data_file.open("w", newline="", encoding="utf-8") as f:
      writer = csv.writer(f)
      writer.writerow(["field1", "field2"])


  def add_row(self, row: Dict[str, str]) -> None:
    if not row.get("field1"):
      raise ValueError("field1 required")
    with self.data_file.open("a", newline="", encoding="utf-8") as f:
      writer = csv.writer(f)
      writer.writerow([row.get("field1"), row.get("field2", "")])


  def read_all(self) -> List[Dict[str, str]]:
    rows = []
    with self.data_file.open("r", newline="", encoding="utf-8") as f:
      reader = csv.DictReader(f)
      for r in reader:
        rows.append(dict(r))
    return rows
